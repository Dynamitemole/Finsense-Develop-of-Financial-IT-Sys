<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>FinSense – Interactive Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="page">
    <header class="hero">
      <div>
        <p class="eyebrow">Personal finance sandbox • Offline & private</p>
        <h1>FinSense Interactive Prototype</h1>
        <p class="lede">Load a CSV, explore spend with filters and charts, and review explainable insights. All logic runs locally in your browser.</p>
        <div class="hero-actions">
          <span class="pill">Now with advanced filters, CSV export, and persistent feedback</span>
          <span class="pill ghost">Base currency: HUF / EUR • Custom FX</span>
        </div>
      </div>
      <div class="hero-badge">
        <div class="badge-number">100%</div>
        <div>
          <div class="badge-title">Feature-complete</div>
          <div class="badge-sub">Filters · Charts · Insights · Evaluation set</div>
        </div>
      </div>
    </header>

    <section class="grid two">
      <article class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Step 1</p>
            <h2>Load your data</h2>
          </div>
          <p class="muted">Expected columns: <code>date, amount, currency, merchant, description, category, country</code></p>
        </div>
        <div class="dropzone" id="dropzone">
          <div class="drop-icon">⬆️</div>
          <div>
            <strong>Drag & drop</strong> your CSV here, or
            <label class="btn primary" for="fileInput">Choose a file</label>
            <input type="file" id="fileInput" accept=".csv" hidden>
          </div>
          <p class="muted">No uploads; everything stays in this tab.</p>
        </div>
        <div id="loadStatus" class="muted status-line"></div>
      </article>

      <article class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Step 2</p>
            <h2>Filters & settings</h2>
          </div>
          <button id="resetBtn" class="btn ghost">Reset all</button>
        </div>
        <div class="control-grid">
          <label class="control">Base currency
            <select id="baseCurrency">
              <option value="HUF">HUF</option>
              <option value="EUR">EUR</option>
            </select>
          </label>
          <label class="control">EUR → HUF rate
            <input id="eurHufRate" type="number" step="0.01" value="395">
          </label>
          <label class="control">Rows per page
            <select id="pageSize">
              <option>25</option>
              <option selected>50</option>
              <option>100</option>
              <option>200</option>
            </select>
          </label>
          <label class="control">Group by
            <select id="groupBy">
              <option value="">None</option>
              <option value="category">Category</option>
              <option value="merchant">Merchant</option>
            </select>
          </label>
          <label class="control">Search (merchant / category / text)
            <input id="searchBox" type="text" placeholder="Type to filter...">
          </label>
          <div class="control actions">
            <button id="exportBtn" class="btn">Export filtered CSV</button>
          </div>
          <label class="control">Date from
            <input id="dateFrom" type="date">
          </label>
          <label class="control">Date to
            <input id="dateTo" type="date">
          </label>
          <label class="control">Amount min (base)
            <input id="amountMin" type="number" placeholder=">= 0">
          </label>
          <label class="control">Amount max (base)
            <input id="amountMax" type="number" placeholder="<= ...">
          </label>
          <label class="control">Category filter (multi-select)
            <select id="categoryFilter" multiple></select>
          </label>
        </div>
      </article>
    </section>

    <section class="panel">
      <div class="panel-head">
        <div>
          <p class="eyebrow">Step 3</p>
          <h2>Dashboard</h2>
          <p class="muted">Live totals react to every filter and your chosen base currency.</p>
        </div>
        <div class="pill ghost">Conversion: EUR×rate → HUF, HUF÷rate → EUR</div>
      </div>
      <div class="metrics">
        <div class="metric">
          <p class="label">Total spend (base)</p>
          <p class="value" id="mTotal">—</p>
        </div>
        <div class="metric">
          <p class="label">Transactions</p>
          <p class="value" id="mCount">—</p>
        </div>
        <div class="metric">
          <p class="label">Unique merchants</p>
          <p class="value" id="mMerchants">—</p>
        </div>
        <div class="metric">
          <p class="label">Top category</p>
          <p class="value" id="mTopCat">—</p>
        </div>
      </div>
    </section>

    <section class="grid two">
      <article class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Step 4</p>
            <h2>Transactions</h2>
            <p class="muted">Sortable, paginated, and collapsible when grouped.</p>
          </div>
        </div>
        <div class="table-wrap">
          <table id="dataTable">
            <thead>
              <tr>
                <th class="sortable" data-key="date">Date</th>
                <th class="sortable" data-key="merchant">Merchant</th>
                <th class="sortable" data-key="category">Category</th>
                <th class="sortable" data-key="currency">Curr</th>
                <th class="sortable" data-key="amount">Amount (native)</th>
                <th class="sortable" data-key="baseAmount">Amount (base)</th>
                <th>Description</th>
                <th>Country</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
        <div class="pagination" id="pager"></div>
      </article>

      <article class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Step 5</p>
            <h2>Visuals</h2>
            <p class="muted">Canvas-only charts, recalculated from the filtered view.</p>
          </div>
        </div>
        <div class="chart-grid">
          <div class="chart-card">
            <div class="chart-title">Category share (donut)</div>
            <canvas id="donut" width="360" height="360"></canvas>
            <div id="legend" class="legend"></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">Monthly spend (bar)</div>
            <canvas id="bar" width="520" height="340"></canvas>
          </div>
        </div>
      </article>
    </section>

    <section class="panel">
      <div class="panel-head">
        <div>
          <p class="eyebrow">Step 6</p>
          <h2>Insights</h2>
          <p class="muted">Rule-based subscriptions and anomalies, with your feedback persisted in localStorage.</p>
        </div>
        <div class="feedback-pills">
          <span class="pill">Whitelisted merchants: <span id="whitelistCount">0</span></span>
          <span class="pill">Dismissed subscriptions: <span id="dismissedSubsCount">0</span></span>
          <span class="pill">Dismissed anomalies: <span id="dismissedAnomsCount">0</span></span>
          <button id="resetFeedback" class="btn ghost">Reset feedback</button>
        </div>
      </div>
      <div class="insight-block">
        <details open>
          <summary>Subscriptions (periodicity + amount stability)</summary>
          <div id="subsContainer" class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Merchant</th><th>Period</th><th>Avg (base)</th><th>Last 3 dates</th><th>Next date</th><th>Confidence</th><th>Actions</th>
                </tr>
              </thead>
              <tbody id="subsBody"></tbody>
            </table>
          </div>
        </details>
        <details open>
          <summary>Anomalies (high amount / new merchant / country switch)</summary>
          <div id="anomContainer" class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Date</th><th>Merchant</th><th>Category</th><th>Base Amount</th><th>Reasons</th><th>Severity</th><th>Actions</th>
                </tr>
              </thead>
              <tbody id="anomBody"></tbody>
            </table>
          </div>
        </details>
      </div>
    </section>
  </div>
  <script src="app.js"></script>
</body>
</html>
